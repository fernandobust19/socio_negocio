<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Empresa - Socio Negocio</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="navbar">
    <div class="nav-brand">Socio Negocio - Panel Empresa</div>
    <div class="nav-right">
      <span id="empresa-name">UPCONS</span>
      <button onclick="logout()" class="btn-logout">Cerrar Sesión</button>
    </div>
  </div>

  <div class="dashboard-container">
    <div class="sidebar">
      <div class="sidebar-item active" onclick="showSection('productos')">🧱 Mis Productos</div>
      <div class="sidebar-item" onclick="showSection('socios')">👥 Socios Activos</div>
      <div class="sidebar-item" onclick="showSection('proformas')">🧾 Proformas Solicitadas</div>
      <div class="sidebar-item" onclick="showSection('ventas')">📊 Reportes de Ventas</div>
      <div class="sidebar-item" onclick="showSection('perfil')">👤 Mi Perfil</div>
    </div>

    <div class="main-content">
      <!-- Productos Section -->
      <div id="productos-section" class="section active">
        <div class="section-header">
          <h2>Gestión de Productos</h2>
          <button onclick="showAddProductModal()" class="btn-primary">+ Agregar Producto</button>
          <button onclick="document.getElementById('catalogo-csv-input').click()" class="btn-secondary">Importar Catálogo (CSV)</button>
          <input type="file" id="catalogo-csv-input" accept=".csv" style="display:none;" />
        </div>
        
        <div class="products-grid" id="products-container">
          <!-- Los productos se cargarán dinámicamente -->
        </div>
      </div>

      <!-- Socios Section -->
      <div id="socios-section" class="section">
        <div class="section-header">
          <h2>Socios Vendiendo Mis Productos</h2>
        </div>
        
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Socio</th>
                <th>Email</th>
                <th>Teléfono</th>
                <th>Productos Vendidos</th>
                <th>Comisión Total</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody id="socios-table">
              <!-- Los socios se cargarán dinámicamente -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Proformas Section -->
      <div id="proformas-section" class="section">
        <div class="section-header">
          <h2>Proformas Solicitadas</h2>
          <div class="filters">
            <select id="proforma-estado-filter" onchange="filterProformas()">
              <option value="">Todos los estados</option>
              <option value="pendiente">Pendientes</option>
              <option value="aprobada">Aprobadas</option>
              <option value="rechazada">Rechazadas</option>
            </select>
          </div>
        </div>
        
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Socio</th>
                <th>Cliente</th>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Total</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="proformas-empresa-table">
              <!-- Las proformas se cargarán dinámicamente -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Ventas Section -->
      <div id="ventas-section" class="section">
        <div class="section-header">
          <h2>Reportes de Ventas</h2>
        </div>
        
        <div class="stats-grid">
          <div class="stat-card">
            <h3>Ventas del Mes</h3>
            <p class="stat-number" id="ventas-mes">$0</p>
          </div>
          <div class="stat-card">
            <h3>Productos Vendidos</h3>
            <p class="stat-number" id="productos-vendidos">0</p>
          </div>
          <div class="stat-card">
            <h3>Comisión Total</h3>
            <p class="stat-number" id="comision-total">$0</p>
          </div>
        </div>
      </div>

      <!-- Perfil Section -->
      <div id="perfil-section" class="section">
        <div class="section-header">
          <h2>Mi Perfil</h2>
        </div>
        <form id="empresa-profile-form" class="profile-form">
          <div class="form-group">
            <label>Nombre de la Empresa:</label>
            <input type="text" id="empresa-nombre" name="nombre" required>
          </div>
          <div class="form-group">
            <label>RUC/Cédula:</label>
            <input type="text" id="empresa-ruc" name="ruc">
          </div>
          <div class="form-group">
            <label>Dirección:</label>
            <input type="text" id="empresa-direccion" name="direccion">
          </div>
          <div class="form-group">
            <label>Teléfono:</label>
            <input type="text" id="empresa-telefono" name="telefono">
          </div>
          <div class="form-group">
            <label>Email:</label>
            <input type="email" id="empresa-email" name="email">
          </div>
          <div class="form-group">
            <label>Descripción:</label>
            <textarea id="empresa-descripcion" name="descripcion" rows="3"></textarea>
          </div>
          <button type="submit" class="btn-primary">Guardar Cambios</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal para agregar productos -->
  <div id="add-product-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeAddProductModal()">&times;</span>
      <h2>Agregar Producto</h2>
      <form id="add-product-form">
        <div class="form-group">
          <label>Nombre del Producto:</label>
          <input type="text" id="product-nombre" name="nombre" required>
        </div>
        <div class="form-group">
          <label>Categoría:</label>
          <select id="product-categoria" name="categoria" required>
            <option value="">Seleccionar categoría</option>
            <option value="tejas">Tejas</option>
            <option value="materiales">Materiales de Construcción</option>
            <option value="herramientas">Herramientas</option>
            <option value="otros">Otros</option>
          </select>
        </div>
        <div class="form-group">
          <label>Precio ($):</label>
          <input type="number" id="product-precio" name="precio" step="0.01" required>
        </div>
        <div class="form-group">
          <label>Comisión para Socios (%):</label>
          <input type="number" id="product-comision" name="comision" min="1" max="50" required>
        </div>
        <div class="form-group">
          <label>Stock Disponible:</label>
          <input type="number" id="product-stock" name="stock" required>
        </div>
        <div class="form-group">
          <label>Descripción:</label>
          <textarea id="product-descripcion" name="descripcion" rows="3"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" onclick="closeAddProductModal()" class="btn-secondary">Cancelar</button>
          <button type="submit" class="btn-primary">Agregar Producto</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para editar productos -->
  <div id="edit-product-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeEditProductModal()">&times;</span>
      <h2>Editar Producto</h2>
      <form id="edit-product-form">
        <input type="hidden" id="edit-product-id" name="id">
        <div class="form-group">
          <label>Nombre del Producto:</label>
          <input type="text" id="edit-product-nombre" name="nombre" required>
        </div>
        <div class="form-group">
          <label>Categoría:</label>
          <select id="edit-product-categoria" name="categoria" required>
            <option value="">Seleccionar categoría</option>
            <option value="tejas">Tejas</option>
            <option value="materiales">Materiales de Construcción</option>
            <option value="herramientas">Herramientas</option>
            <option value="otros">Otros</option>
          </select>
        </div>
        <div class="form-group">
          <label>Precio ($):</label>
          <input type="number" id="edit-product-precio" name="precio" step="0.01" required>
        </div>
        <div class="form-group">
          <label>Comisión para Socios (%):</label>
          <input type="number" id="edit-product-comision" name="comision" min="1" max="50" required>
        </div>
        <div class="form-group">
          <label>Stock Disponible:</label>
          <input type="number" id="edit-product-stock" name="stock" required>
        </div>
        <div class="form-group">
          <label>Descripción:</label>
          <textarea id="edit-product-descripcion" name="descripcion" rows="3"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" onclick="closeEditProductModal()" class="btn-secondary">Cancelar</button>
          <button type="submit" class="btn-primary">Actualizar Producto</button>
        </div>
      </form>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', function() {
      loadEmpresaProfile();
      loadProducts();
      loadSocios();
      loadProformasEmpresa();
      loadVentas();
      loadStats();
      const csvInput = document.getElementById('catalogo-csv-input');
      if (csvInput) {
        csvInput.addEventListener('change', function(){
          if (this.files && this.files[0]) {
            importCatalogoDesdeCSV(this.files[0]);
            this.value = '';
          }
        });
      }
    });

    // Handle add product form
    document.getElementById('add-product-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const producto = Object.fromEntries(formData.entries());
      
      if (addProduct(producto)) {
        alert('Producto agregado exitosamente');
        closeAddProductModal();
        loadProducts();
      }
    });

    // Handle profile update
    document.getElementById('empresa-profile-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const profileData = Object.fromEntries(formData.entries());
      
      if (updateEmpresaProfile(profileData)) {
        alert('Perfil actualizado exitosamente');
      }
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Socio - Socio Negocio</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="navbar">
    <div class="nav-brand">Socio Negocio - Panel Socio</div>
    <div class="nav-right">
      <span id="socio-name">Socio</span>
      <button onclick="logout()" class="btn-logout">Cerrar Sesión</button>
    </div>
  </div>

  <div class="dashboard-container">
    <div class="sidebar">
      <div class="sidebar-item active" onclick="showSection('empresas')">🏢 Empresas Disponibles</div>
      <div class="sidebar-item" onclick="showSection('productos')">🧱 Productos para Vender</div>
      <div class="sidebar-item" onclick="showSection('clientes')">👥 Mis Clientes</div>
      <div class="sidebar-item" onclick="showSection('proformas')">🧾 Proformas</div>
      <div class="sidebar-item" onclick="showSection('mis-ventas')">🛒 Mis Ventas</div>
      <div class="sidebar-item" onclick="showSection('comisiones')">💰 Comisiones</div>
      <div class="sidebar-item" onclick="showSection('perfil')">👤 Mi Perfil</div>
    </div>

    <div class="main-content">
      <!-- Empresas Section -->
      <div id="empresas-section" class="section active">
        <div class="section-header">
          <h2>Empresas Registradas</h2>
          <p class="section-subtitle">Selecciona las empresas cuyos productos quieres vender</p>
        </div>
        
        <div class="empresas-grid" id="empresas-container">
          <!-- Las empresas se cargarán dinámicamente -->
        </div>
      </div>

      <!-- Productos Section -->
      <div id="productos-section" class="section">
        <div class="section-header">
          <h2>Productos Disponibles para Vender</h2>
          <div class="filters">
            <select id="empresa-filter" onchange="filterProducts()">
              <option value="">Todas las empresas</option>
            </select>
            <select id="categoria-filter" onchange="filterProducts()">
              <option value="">Todas las categorías</option>
              <option value="tejas">Tejas</option>
              <option value="materiales">Materiales de Construcción</option>
              <option value="herramientas">Herramientas</option>
              <option value="otros">Otros</option>
            </select>
            <input type="search" id="search-filter" placeholder="Buscar por nombre, descripción o color" oninput="filterProducts()" />
          </div>
        </div>
        
        <div class="products-grid" id="productos-disponibles">
          <!-- Los productos se cargarán dinámicamente -->
        </div>
      </div>

      <!-- Clientes Section -->
      <div id="clientes-section" class="section">
        <div class="section-header">
          <h2>Gestión de Clientes</h2>
          <button onclick="showAgregarClienteModal()" class="btn-primary">+ Agregar Cliente</button>
        </div>
        
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Nombre/Empresa</th>
                <th>Contacto</th>
                <th>Email</th>
                <th>Teléfono</th>
                <th>Dirección</th>
                <th>Proformas</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="clientes-table">
              <!-- Los clientes se cargarán dinámicamente -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Proformas Section -->
      <div id="proformas-section" class="section">
        <div class="section-header">
          <h2>Mis Proformas</h2>
          <div class="filters">
            <select id="proformas-estado-filter" onchange="filterProformasSocio()">
              <option value="">Todos los estados</option>
              <option value="enviada">Enviadas</option>
              <option value="aprobada">Aprobadas</option>
              <option value="rechazada">Rechazadas</option>
            </select>
          </div>
        </div>
        
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Cliente</th>
                <th>Empresa</th>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Precio Estimado</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="proformas-socio-table">
              <!-- Las proformas se cargarán dinámicamente -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Mis Ventas Section -->
      <div id="mis-ventas-section" class="section">
        <div class="section-header">
          <h2>Mis Ventas</h2>
          <button onclick="showRegistrarVentaModal()" class="btn-primary">+ Registrar Venta</button>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Empresa</th>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Total</th>
                <th>Comisión</th>
              </tr>
            </thead>
            <tbody id="ventas-socio-table">
              <!-- Las ventas se cargarán dinámicamente -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Comisiones Section -->
      <div id="comisiones-section" class="section">
        <div class="section-header">
          <h2>Comisiones</h2>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <h3>Comisiones del Mes</h3>
            <p class="stat-number" id="comisiones-mes">$0</p>
          </div>
          <div class="stat-card">
            <h3>Comisiones Totales</h3>
            <p class="stat-number" id="comisiones-total">$0</p>
          </div>
          <div class="stat-card">
            <h3>Empresas Colaborando</h3>
            <p class="stat-number" id="empresas-colaborando">0</p>
          </div>
        </div>
      </div>

      <!-- Perfil Section -->
      <div id="perfil-section" class="section">
        <div class="section-header">
          <h2>Mi Perfil</h2>
        </div>
        <form id="socio-profile-form" class="profile-form">
          <div class="form-group">
            <label>Nombres:</label>
            <input type="text" id="perfil-nombres" name="nombres" required>
          </div>
          <div class="form-group">
            <label>Apellidos:</label>
            <input type="text" id="perfil-apellidos" name="apellidos" required>
          </div>
          <div class="form-group">
            <label>Cédula:</label>
            <input type="text" id="perfil-cedula" name="cedula" required>
          </div>
          <div class="form-group">
            <label>Teléfono:</label>
            <input type="text" id="perfil-telefono" name="telefono" required>
          </div>
          <div class="form-group">
            <label>Email:</label>
            <input type="email" id="perfil-email" name="email" required>
          </div>
          <div class="form-group">
            <label>Dirección:</label>
            <input type="text" id="perfil-direccion" name="direccion">
          </div>
          <div class="form-group">
            <label>Experiencia:</label>
            <textarea id="perfil-experiencia" name="experiencia" rows="3"></textarea>
          </div>
          <button type="submit" class="btn-primary">Guardar Cambios</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal para ver proforma recibida -->
  <div id="ver-proforma-modal" class="modal">
    <div class="modal-content proforma-modal">
      <span class="close" onclick="closeVerProformaModal()">&times;</span>
      <div id="proforma-content">
        <!-- El contenido de la proforma se cargará aquí -->
      </div>
      <div class="form-actions">
        <button onclick="descargarProforma()" class="btn-primary">Descargar PDF</button>
        <button onclick="closeVerProformaModal()" class="btn-secondary">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal para registrar venta -->
  <div id="registrar-venta-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeRegistrarVentaModal()">&times;</span>
      <h2>Registrar Nueva Venta</h2>
      <form id="registrar-venta-form">
        <div class="form-group">
          <label>Empresa:</label>
          <select id="venta-empresa" name="empresaId" required onchange="loadProductosVenta()">
            <option value="">Seleccionar empresa</option>
          </select>
        </div>
        <div class="form-group">
          <label>Producto:</label>
          <select id="venta-producto" name="productoId" required onchange="updatePrecioVenta()">
            <option value="">Seleccionar producto</option>
          </select>
        </div>
        <div class="form-group">
          <label>Cantidad:</label>
          <input type="number" id="venta-cantidad" name="cantidad" min="1" required onchange="calculateTotal()">
        </div>
        <div class="form-group">
          <label>Precio Unitario:</label>
          <input type="number" id="venta-precio" name="precio" step="0.01" readonly>
        </div>
        <div class="form-group">
          <label>Total de la Venta:</label>
          <input type="number" id="venta-total" name="total" step="0.01" readonly>
        </div>
        <div class="form-group">
          <label>Tu Comisión:</label>
          <input type="number" id="venta-comision" name="comision" step="0.01" readonly>
        </div>
        <div class="form-group">
          <label>Cliente:</label>
          <input type="text" id="venta-cliente" name="cliente" required>
        </div>
        <div class="form-group">
          <label>Notas:</label>
          <textarea id="venta-notas" name="notas" rows="2"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" onclick="closeRegistrarVentaModal()" class="btn-secondary">Cancelar</button>
          <button type="submit" class="btn-primary">Registrar Venta</button>
        </div>
      </form>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', function() {
      loadSocioProfile();
      loadEmpresas();
      loadProductosDisponibles();
      loadClientes();
      loadProformasSocio();
      loadVentasSocio();
      loadComisionesSocio();
    });

    // Handle registrar venta form
    document.getElementById('registrar-venta-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const venta = Object.fromEntries(formData.entries());
      
      if (registrarVenta(venta)) {
        alert('Venta registrada exitosamente');
        closeRegistrarVentaModal();
        loadVentasSocio();
        loadComisionesSocio();
      }
    });

    // Handle profile update
    document.getElementById('socio-profile-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const profileData = Object.fromEntries(formData.entries());
      
      if (updateSocioProfile(profileData)) {
        alert('Perfil actualizado exitosamente');
      }
    });
  </script>
</body>
</html>
